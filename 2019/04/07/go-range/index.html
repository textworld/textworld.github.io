<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>go_range | TEXT-WORLD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一行代码了解range的原理">
<meta property="og:type" content="article">
<meta property="og:title" content="go_range">
<meta property="og:url" content="http://textworld.github.io/2019/04/07/go-range/index.html">
<meta property="og:site_name" content="TEXT-WORLD">
<meta property="og:description" content="一行代码了解range的原理">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-06-30T03:38:05.072Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="go_range">
<meta name="twitter:description" content="一行代码了解range的原理">
  
    <link rel="alternate" href="/atom.xml" title="TEXT-WORLD" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">TEXT-WORLD</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://textworld.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-go-range" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/07/go-range/" class="article-date">
  <time datetime="2019-04-07T08:03:30.000Z" itemprop="datePublished">2019-04-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      go_range
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一行代码了解range的原理</p>
<a id="more"></a>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">    names := []<span class="keyword">string</span>&#123;<span class="string">"John"</span>, <span class="string">"James"</span>, <span class="string">"Fat"</span>, <span class="string">"Cat"</span>&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">var</span> name <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">for</span> i, name = <span class="keyword">range</span> names &#123;</span><br><span class="line">		log.Printf(<span class="string">"Range: n:%v, point of n: %p, point of name[i]:%p"</span>, name, &amp;name, &amp;(names[i]))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2019/04/07 16:14:15 Range: n:John, point of n: 0xc00000e1e0, point of name[i]:0xc0000460c0</span><br><span class="line">2019/04/07 16:14:15 Range: n:James, point of n: 0xc00000e1e0, point of name[i]:0xc0000460d0</span><br><span class="line">2019/04/07 16:14:15 Range: n:Fat, point of n: 0xc00000e1e0, point of name[i]:0xc0000460e0</span><br><span class="line">2019/04/07 16:14:15 Range: n:Cat, point of n: 0xc00000e1e0, point of name[i]:0xc0000460f0</span><br></pre></td></tr></table></figure></p>
<p>相信这段代码非常好理解, 每次循环时, 都将值赋给变量i和name, 打印name的内存地址自然不会改变, 下面稍微改动下代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">    name := []<span class="keyword">string</span>&#123;<span class="string">"John"</span>, <span class="string">"James"</span>, <span class="string">"Fat"</span>, <span class="string">"Cat"</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, n := <span class="keyword">range</span> name &#123;</span><br><span class="line">        log.Printf(<span class="string">"Range: n:%v, point of n: %p, point of name[i]:%p"</span>, n, &amp;n, &amp;(name[i]))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2019/04/07 16:05:44 Range: n:John, point of n: 0xc00000e1e0, point of name[i]:0xc0000460c0</span><br><span class="line">2019/04/07 16:05:44 Range: n:James, point of n: 0xc00000e1e0, point of name[i]:0xc0000460d0</span><br><span class="line">2019/04/07 16:05:44 Range: n:Fat, point of n: 0xc00000e1e0, point of name[i]:0xc0000460e0</span><br><span class="line">2019/04/07 16:05:44 Range: n:Cat, point of n: 0xc00000e1e0, point of name[i]:0xc0000460f0</span><br></pre></td></tr></table></figure>
<p>从打印的结果中可以看出, 其实打印出来的结果和上面的一样的(虽然内存地址不一样), n这个变量始终指向了同一个内存地址, 也就是说, range的作用就是遍历数据, 然后将遍历到的值都赋给n.  这句话说明了这个现象  </p>
<blockquote>
<p>If you use the short variable declaration style assignment (:=), Go will reuse the variables for each iteration of the loop (only in scope inside the loop).</p>
</blockquote>
<p>大概翻译成中文意思是: 使用了:=这种形式, 在每次循环中, 这个变量还是会被重用, 所以上面两个实验的结果其实是一样的, 这样的好处就是不用反复申请新的内存地址  </p>
<h2 id="range-for-map"><a href="#range-for-map" class="headerlink" title="range for map"></a>range for map</h2><blockquote>
<p>If map entries that have not yet been reached are removed during iteration, the corresponding iteration values will not be produced. If map entries are created during iteration, that entry may be produced during the iteration or may be skipped.</p>
</blockquote>
<p>这里只提到了在循环中,删除未遍历到的entry, 则被删除的值将不会被遍历到. 对于增加, 则有可能会被遍历到,也有可能不会. 至于这条是不是适用于数组, 那就不清楚了.</p>
<h2 id="range需要知道的几点"><a href="#range需要知道的几点" class="headerlink" title="range需要知道的几点"></a>range需要知道的几点</h2><h3 id="range是在一个拷贝的副本上进行的"><a href="#range是在一个拷贝的副本上进行的" class="headerlink" title="range是在一个拷贝的副本上进行的"></a>range是在一个拷贝的副本上进行的</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IndexValueArray</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := [...]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, v := <span class="keyword">range</span> a &#123;</span><br><span class="line">		a[<span class="number">3</span>] = <span class="number">100</span></span><br><span class="line">		<span class="keyword">if</span> i == <span class="number">3</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"IndexValueArray"</span>, i, v)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="comment">// IndexValueArray 3 4</span></span><br></pre></td></tr></table></figure>
<p>如果确实想要改变, 可以这么改</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IndexValueArrayPtr</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := [...]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, v := <span class="keyword">range</span> &amp;a &#123;</span><br><span class="line">		a[<span class="number">3</span>] = <span class="number">100</span></span><br><span class="line">		<span class="keyword">if</span> i == <span class="number">3</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"IndexValueArrayPtr"</span>, i, v)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出</span></span><br><span class="line"><span class="comment">// IndexValueArrayPtr 3 100</span></span><br></pre></td></tr></table></figure>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><ol>
<li><a href="https://garbagecollected.org/2017/02/22/go-range-loop-internals/" target="_blank" rel="noopener">https://garbagecollected.org/2017/02/22/go-range-loop-internals/</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://textworld.github.io/2019/04/07/go-range/" data-id="cjxif1mib0001g292gb6m5cy3" class="article-share-link">Share</a>
      
        <a href="http://textworld.github.io/2019/04/07/go-range/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/05/07/go-flags/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          go-flags
        
      </div>
    </a>
  
  
    <a href="/2019/03/12/flink/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">各类关键数据格式读取/SQL支持</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/06/30/hexo/">hexo</a>
          </li>
        
          <li>
            <a href="/2019/06/23/java/">java</a>
          </li>
        
          <li>
            <a href="/2019/06/18/learing-plan/">learing-plan</a>
          </li>
        
          <li>
            <a href="/2019/06/02/myserver/">myserver</a>
          </li>
        
          <li>
            <a href="/2019/05/30/paxos/">paxos</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 textworld<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'text-world';
  
  var disqus_url = 'http://textworld.github.io/2019/04/07/go-range/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>